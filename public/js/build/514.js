"use strict";(self.webpackChunkDooTask=self.webpackChunkDooTask||[]).push([[514],{87189:(t,e,o)=>{o.d(e,{A:()=>l});var s=o(95353);function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function a(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,s)}return o}function r(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?a(Object(o),!0).forEach((function(e){i(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function i(t,e,o){return(e=function(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var s=o.call(t,e||"default");if("object"!=n(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==n(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}const c={name:"TaskMenu",props:{task:{type:Object,default:function(){return{}}},loadStatus:{type:Boolean,default:!1},colorShow:{type:Boolean,default:!0},updateBefore:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},size:{type:String,default:"small"},icon:{type:String,default:"md-radio-button-off"},completedIcon:{type:String,default:"md-checkmark-circle"}},data:function(){return{}},computed:r(r({},(0,s.aH)(["taskColorList","taskLoading","taskFlows","taskFlowItems"])),{},{loadIng:function(){var t=this;if(this.loadStatus)return!0;var e=this.taskLoading.find((function(e){return e.id==t.task.id}));return e&&e.num>0},flow:function(){var t=this;return this.taskFlows.find((function(e){return e.task_id==t.task.id}))},turns:function(){var t=this;if(!this.flow)return[];var e=this.taskFlowItems.find((function(e){return e.id==t.flow.flow_item_id}));return e?this.taskFlowItems.filter((function(t){var o=t.id;return e.turns.includes(o)})):[]}}),methods:{show:function(){this.$refs.dropdown.show()},hide:function(){this.$refs.dropdown.hide()},handleClick:function(){this.$refs.dropdown.handleClick()},dropTask:function(t){var e=this,o=this.task,s=function(t){t?e.$store.dispatch("saveTaskCompleteTemp",o.id):e.$store.dispatch("forgetTaskCompleteTemp",o.id)};if($A.isJson(t))t.name&&this.updateTask({color:t.color}).catch((function(){}));else{if($A.leftExists(t,"turn::")){var n=$A.leftDelete(t,"turn::");if(n==this.task.flow_item_id)return;var a=this.taskFlowItems.find((function(t){return t.id==e.flow.flow_item_id}))||{},r=this.taskFlowItems.find((function(t){return t.id==n}))||{},i="end"!==a.status&&"end"===r.status,c="end"===a.status&&"end"!==r.status;return this.updateBefore&&(i?s(!0):c&&s(!1)),void this.updateTask({flow_item_id:n}).then((function(){i?s(!0):c&&s(!1)})).catch((function(){i?s(!1):c&&s(!0)}))}switch(t){case"complete":if(this.task.complete_at)return;this.updateBefore&&s(!0),this.updateTask({complete_at:$A.formatDate("Y-m-d H:i:s")}).then((function(){s(!0)})).catch((function(){s(!1)}));break;case"uncomplete":if(!this.task.complete_at)return;this.updateBefore&&s(!1),this.updateTask({complete_at:!1}).then((function(){s(!1)})).catch((function(){s(!0)}));break;case"archived":case"remove":this.archivedOrRemoveTask(t)}}},visibleChange:function(t){t&&this.$store.dispatch("getTaskFlow",this.task.id).then(this.$refs.dropdownMenu.updatePopper).catch(this.$refs.dropdownMenu.updatePopper)},updateTask:function(t){var e=this;return new Promise((function(o,s){e.loadIng?s():(Object.keys(t).forEach((function(o){return e.$set(e.task,o,t[o])})),e.$store.dispatch("taskUpdate",Object.assign(t,{task_id:e.task.id})).then((function(t){var s=t.data,n=t.msg;$A.messageSuccess(n),o(),e.$emit("on-update",s)})).catch((function(t){var o=t.msg;$A.modalError(o),e.$store.dispatch("getTaskOne",e.task.id).catch((function(){})),s()})))}))},archivedOrRemoveTask:function(t){var e=this,o="removeTask",s="删除",n={task_id:this.task.id},a=this.task.parent_id>0?"子任务":"任务";"archived"==t&&(o="archivedTask",s="归档",this.task.archived_at&&(s="还原归档",n={task_id:this.task.id,type:"recovery"})),$A.modalConfirm({title:s+a,content:"你确定要"+s+a+"【"+this.task.name+"】吗？",loading:!0,onOk:function(){e.loadIng?e.$Modal.remove():e.$store.dispatch(o,n).then((function(t){var o=t.msg;$A.messageSuccess(o),e.$Modal.remove()})).catch((function(t){var o=t.msg;$A.modalError(o,301),e.$Modal.remove()}))}})}}};const l=(0,o(14486).A)(c,(function(){var t=this,e=t._self._c;return e("EDropdown",{ref:"dropdown",attrs:{trigger:"click",disabled:t.disabled,size:t.size,placement:"bottom"},on:{command:t.dropTask,"visible-change":t.visibleChange}},[t._t("icon",(function(){return[e("div",{staticClass:"task-menu-icon"},[t.loadIng?e("div",{staticClass:"loading"},[e("Loading")],1):[t.task.complete_at?e("Icon",{staticClass:"completed",attrs:{type:t.completedIcon}}):e("Icon",{staticClass:"uncomplete",attrs:{type:t.icon}})]],2)]})),t._v(" "),e("EDropdownMenu",{ref:"dropdownMenu",staticClass:"task-menu-more-dropdown",attrs:{slot:"dropdown"},slot:"dropdown"},[e("li",{staticClass:"task-menu-more-warp",class:t.size},[e("ul",[t.flow?t.turns.length>0?t._l(t.turns,(function(o){return e("EDropdownItem",{key:o.id,attrs:{command:"turn::".concat(o.id)}},[e("div",{staticClass:"item flow"},[o.id==t.task.flow_item_id&&!0!==t.flow.auto_assign?e("Icon",{staticClass:"check",attrs:{type:"md-checkmark-circle-outline"}}):e("Icon",{attrs:{type:"md-radio-button-off"}}),t._v(" "),e("div",{staticClass:"flow-name",class:o.status},[t._v(t._s(o.name))])],1)])})):[t.task.complete_at?e("EDropdownItem",{attrs:{command:"uncomplete"}},[e("div",{staticClass:"item red"},[e("Icon",{attrs:{type:"md-checkmark-circle-outline"}}),t._v(t._s(t.$L("标记未完成"))+"\n                        ")],1)]):e("EDropdownItem",{attrs:{command:"complete"}},[e("div",{staticClass:"item"},[e("Icon",{attrs:{type:"md-radio-button-off"}}),t._v(t._s(t.$L("完成"))+"\n                        ")],1)])]:e("EDropdownItem",{staticClass:"load-flow",attrs:{disabled:""}},[e("div",{staticClass:"load-flow-warp"},[e("Loading")],1)]),t._v(" "),0===t.task.parent_id?[e("EDropdownItem",{attrs:{divided:t.turns.length>0,command:"archived"}},[e("div",{staticClass:"item"},[e("Icon",{attrs:{type:"ios-filing"}}),t._v(t._s(t.$L(t.task.archived_at?"还原归档":"归档"))+"\n                        ")],1)]),t._v(" "),e("EDropdownItem",{attrs:{command:"remove"}},[e("div",{staticClass:"item hover-del"},[e("Icon",{attrs:{type:"md-trash"}}),t._v(t._s(t.$L("删除"))+"\n                        ")],1)]),t._v(" "),t.colorShow?t._l(t.taskColorList,(function(o,s){return e("EDropdownItem",{key:"c_"+s,attrs:{divided:0==s,command:o}},[e("div",{staticClass:"item"},[e("i",{staticClass:"taskfont",style:{color:o.color||"#f9f9f9"},domProps:{innerHTML:t._s(o.color==t.task.color?"&#xe61d;":"&#xe61c;")}}),t._v(t._s(t.$L(o.name))+"\n                            ")])])})):t._e()]:e("EDropdownItem",{attrs:{command:"remove",divided:t.turns.length>0}},[e("div",{staticClass:"item"},[e("Icon",{attrs:{type:"md-trash"}}),t._v(t._s(t.$L("删除"))+"\n                    ")],1)])],2)])])],2)}),[],!1,null,null,null).exports},45133:(t,e,o)=>{o.r(e),o.d(e,{default:()=>l});var s=o(95353);function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function a(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,s)}return o}function r(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?a(Object(o),!0).forEach((function(e){i(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function i(t,e,o){return(e=function(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var s=o.call(t,e||"default");if("object"!=n(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==n(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}const c={components:{TaskMenu:o(87189).A},data:function(){return{nowTime:$A.Time(),nowInterval:null,loadIng:0,dashboard:"today"}},mounted:function(){var t=this;this.nowInterval=setInterval((function(){t.nowTime=$A.Time()}),1e3)},destroyed:function(){clearInterval(this.nowInterval)},activated:function(){this.$store.dispatch("getTaskForDashboard")},deactivated:function(){this.$store.dispatch("forgetTaskCompleteTemp",!0)},computed:r(r(r({},(0,s.aH)(["userInfo"])),(0,s.L8)(["dashboardTask","transforTasks"])),{},{columns:function(){var t=this,e=[];return["today","overdue","all"].some((function(o){var s=t.transforTasks(t.dashboardTask[o]);e.push({type:o,title:t.getTitle(o),list:s.sort((function(t,e){return $A.Date(t.end_at||"2099-12-31 23:59:59")-$A.Date(e.end_at||"2099-12-31 23:59:59")}))})})),e},total:function(){var t=this.dashboardTask;return t.today.length+t.overdue.length+t.all.length}}),methods:{getTitle:function(t){switch(t){case"today":return this.$L("今日任务");case"overdue":return this.$L("超期任务");case"all":return this.$L("待完成任务");default:return""}},scrollTo:function(t){$A.scrollToView(this.$refs["type_".concat(t)][0],{behavior:"smooth",inline:"end"})},openTask:function(t){this.$store.dispatch("openTask",t)},openMenu:function(t,e){var o=this.$refs["taskMenu_".concat(t,"_").concat(e.id)];o&&o[0].handleClick()},expiresFormat:function(t){return $A.countDownFormat(t,this.nowTime)}}};const l=(0,o(14486).A)(c,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"page-dashboard"},[e("PageTitle",{attrs:{title:t.$L("仪表盘")}}),t._v(" "),e("div",{staticClass:"dashboard-wrapper"},[e("div",{staticClass:"dashboard-hello"},[t._v(t._s(t.$L("欢迎您，"+t.userInfo.nickname)))]),t._v(" "),e("div",{staticClass:"dashboard-desc"},[t._v(t._s(t.$L("以下是你当前的任务统计数据")))]),t._v(" "),e("ul",{staticClass:"dashboard-block"},[e("li",{on:{click:function(e){return t.scrollTo("today")}}},[e("div",{staticClass:"block-title"},[t._v(t._s(t.getTitle("today")))]),t._v(" "),e("div",{staticClass:"block-data"},[e("div",{staticClass:"block-num"},[t._v(t._s(t.dashboardTask.today.length))]),t._v(" "),e("i",{staticClass:"taskfont"},[t._v("")])])]),t._v(" "),e("li",{on:{click:function(e){return t.scrollTo("overdue")}}},[e("div",{staticClass:"block-title"},[t._v(t._s(t.getTitle("overdue")))]),t._v(" "),e("div",{staticClass:"block-data"},[e("div",{staticClass:"block-num"},[t._v(t._s(t.dashboardTask.overdue.length))]),t._v(" "),e("i",{staticClass:"taskfont"},[t._v("")])])]),t._v(" "),e("li",{on:{click:function(e){return t.scrollTo("all")}}},[e("div",{staticClass:"block-title"},[t._v(t._s(t.getTitle("all")))]),t._v(" "),e("div",{staticClass:"block-data"},[e("div",{staticClass:"block-num"},[t._v(t._s(t.dashboardTask.all.length))]),t._v(" "),e("i",{staticClass:"taskfont"},[t._v("")])])])]),t._v(" "),e("div",{staticClass:"dashboard-list overlay-y"},[t._l(t.columns,(function(o){return o.list.length>0?[e("div",{ref:"type_".concat(o.type),refInFor:!0,staticClass:"dashboard-ref"}),t._v(" "),e("div",{staticClass:"dashboard-title"},[t._v(t._s(o.title))]),t._v(" "),e("ul",{staticClass:"dashboard-ul"},t._l(o.list,(function(s,n){return e("li",{key:n,class:{complete:s.complete_at},style:s.color?{backgroundColor:s.color}:{},on:{click:function(e){return t.openTask(s)}}},[s.p_name?e("em",{staticClass:"priority-color",style:{backgroundColor:s.p_color}}):t._e(),t._v(" "),e("TaskMenu",{ref:"taskMenu_".concat(o.type,"_").concat(s.id),refInFor:!0,attrs:{task:s}},[e("div",{staticClass:"drop-icon",attrs:{slot:"icon"},on:{click:function(t){t.stopPropagation()}},slot:"icon"},[e("i",{staticClass:"taskfont",domProps:{innerHTML:t._s(s.complete_at?"&#xe627;":"&#xe625;")}})])]),t._v(" "),e("div",{staticClass:"item-title"},[s.flow_item_name?e("span",{class:s.flow_item_status,on:{click:function(e){return e.stopPropagation(),t.openMenu(o.type,s)}}},[t._v(t._s(s.flow_item_name))]):t._e(),t._v(" "),!0===s.sub_top?e("span",[t._v(t._s(t.$L("子任务")))]):t._e(),t._v(" "),s.sub_my&&s.sub_my.length>0?e("span",[t._v("+"+t._s(s.sub_my.length))]):t._e(),t._v(" "),t._v("\n                            "+t._s(s.name)+"\n                        ")]),t._v(" "),s.desc?e("div",{staticClass:"item-icon"},[e("i",{staticClass:"taskfont"},[t._v("")])]):t._e(),t._v(" "),s.sub_num>0?e("div",{staticClass:"item-icon"},[e("i",{staticClass:"taskfont"},[t._v("")]),t._v(" "),e("em",[t._v(t._s(s.sub_complete)+"/"+t._s(s.sub_num))])]):t._e(),t._v(" "),s.end_at?e("ETooltip",{attrs:{content:s.end_at,placement:"right"}},[e("div",{class:["item-icon",s.today?"today":"",s.overdue?"overdue":""]},[e("i",{staticClass:"taskfont"},[t._v("")]),t._v(" "),e("em",[t._v(t._s(t.expiresFormat(s.end_at)))])])]):t._e()],1)})),0)]:t._e()}))],2)])],1)}),[],!1,null,null,null).exports}}]);